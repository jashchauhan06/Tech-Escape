<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tech Escape Admin</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    body { font-family: Inter, system-ui, Arial, sans-serif; background: #0a0e1a; color: #fff; }
    .container { max-width: 720px; margin: 48px auto; padding: 24px; background: #1a1f2e; border: 1px solid #374151; border-radius: 12px; }
    .row { display: flex; gap: 12px; align-items: center; margin-bottom: 16px; }
    input[type="password"] { flex: 1; padding: 10px 12px; border-radius: 8px; border: 1px solid #374151; background: #2a2f3e; color: #fff; }
    button { padding: 10px 14px; border-radius: 8px; border: 1px solid transparent; cursor: pointer; color: #fff; }
    .btn-start { background: #16a34a; }
    .btn-stop { background: #ef4444; }
    .btn-status { background: #2563eb; }
    .status { margin-top: 16px; padding: 12px; border-radius: 8px; background: #0f172a; border: 1px solid #334155; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 12px; white-space: pre-wrap; }
    h1 { margin-top: 0; }
  </style>
  <script>
    async function getStatus() {
      const res = await fetch('/api/game-status');
      const data = await res.json();
      const box = document.getElementById('status');
      if (data.started) {
        const mins = Math.floor((data.remainingMs || 0) / 60000);
        const secs = Math.floor(((data.remainingMs || 0) % 60000) / 1000);
        box.textContent = `started: true\nremainingMs: ${data.remainingMs}\nremaining: ${String(mins).padStart(2,'0')}:${String(secs).padStart(2,'0')}\nstartedAt: ${data.startedAt}`;
      } else {
        box.textContent = `started: false`;
      }
    }

    async function control(action, extra = {}) {
      const secret = document.getElementById('secret').value.trim();
      if (!secret) { alert('Enter admin secret'); return; }
      const res = await fetch('/api/game-status', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'X-Admin-Key': secret },
        body: JSON.stringify({ action, ...extra })
      });
      const data = await res.json();
      if (!res.ok || data.success === false) {
        alert('Error: ' + (data.error || 'Request failed'));
      }
      getStatus();
    }

    window.addEventListener('DOMContentLoaded', getStatus);
  </script>
  </head>
  <body>
    <div class="container">
      <h1>Tech Escape Admin</h1>
      <div class="row">
        <input id="secret" type="password" placeholder="Enter ADMIN_SECRET" autocomplete="off" />
        <button class="btn-status" onclick="getStatus()">Check Status</button>
      </div>
      <div class="row">
        <button class="btn-start" onclick="control('start', { durationMinutes: document.getElementById('duration').value || 15 })">Start Game</button>
        <button class="btn-stop" onclick="control('stop')">Stop / Reset</button>
      </div>
      <div class="row">
        <input id="duration" type="number" min="1" max="180" placeholder="Duration minutes (default 15)" style="flex:1;padding:10px 12px;border-radius:8px;border:1px solid #374151;background:#2a2f3e;color:#fff;" />
        <button class="btn-status" onclick="control('extend', { minutes: document.getElementById('extend').value || 5 })">Extend by (min)</button>
        <input id="extend" type="number" min="1" max="60" value="5" style="width:100px;padding:10px 12px;border-radius:8px;border:1px solid #374151;background:#2a2f3e;color:#fff;" />
      </div>
      <div class="row">
        <button class="btn-status" onclick="control('pause')">Pause</button>
        <button class="btn-status" onclick="control('resume')">Resume</button>
      </div>
      <div id="status" class="status">Loading...</div>
      <p style="margin-top:16px; color:#a8b3cf; font-size:12px;">Note: This page only sends your secret in the request header to your own domain. It is not stored in the browser.</p>
    </div>
  </body>
</html>


